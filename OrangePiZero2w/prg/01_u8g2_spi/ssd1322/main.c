#include <stdio.h>
#include <u8g2.h>

#include "u8x8_linux-spi.h"

static const uint8_t logo[] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0xE0, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x1F, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3E, 0x3C, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x78, 0x1E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x0E,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x70, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0xF0, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x0E, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0xF0, 0x1E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0,
  0x3C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF0, 0x7C, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x73, 0xF8, 0x30, 0x3C, 0x3F, 0xC0, 0x00, 0x0C, 0x77, 0xF0, 0x38,
  0x7E, 0x3F, 0xC0, 0x00, 0x7E, 0x73, 0xC0, 0x38, 0xE7, 0x06, 0x00, 0x00, 0xFC,
  0x71, 0x00, 0x38, 0xE3, 0x06, 0x00, 0x01, 0xF0, 0x70, 0x00, 0x38, 0xE3, 0x06,
  0x00, 0x01, 0xC0, 0x70, 0x00, 0x38, 0xE3, 0x06, 0x00, 0x03, 0x80, 0x70, 0xC0,
  0x38, 0xE3, 0x06, 0x00, 0x03, 0x80, 0x71, 0xE0, 0x38, 0xE3, 0x06, 0x00, 0x03,
  0x80, 0x70, 0xE0, 0x38, 0xE3, 0x06, 0x00, 0x03, 0x80, 0x70, 0xF0, 0x38, 0xE3,
  0x06, 0x00, 0x03, 0x80, 0x70, 0x70, 0x38, 0xE3, 0x06, 0x00, 0x03, 0x80, 0xF0,
  0x78, 0x38, 0xE3, 0x06, 0x00, 0x03, 0xC1, 0xE0, 0x3C, 0x38, 0xE7, 0x06, 0x00,
  0x01, 0xE3, 0xE0, 0x3C, 0x38, 0x7E, 0x06, 0x00, 0x01, 0xFF, 0xC0, 0x1C, 0x30,
  0x3C, 0x06, 0x00, 0x00, 0x7F, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1C,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};

int
main (void)
{

  uint32_t screen = 0;

  u8g2_t u8g2;

  u8g2_Setup_ssd1322_nhd_256x64_1 (&u8g2, U8G2_R0, u8x8_byte_linux_spi,
                                   u8x8_linux_spi_delay);

  u8x8_linux_i2c_t user_data = {

    // Настройки SPI
    .adapter_nr = 1, /* /dev/spidev1.0 */
    .mode = SPI_MODE_0, .bits = 8, .speed = 1000000,

    .iDC_piochip = 0, // gpiochip0
    .iDC_line = 260,  // PI4

    .iCS0_piochip = 0, // gpiochip0
    .iCS0_line = 259,  // PI3
  };
  u8g2_SetUserPtr (&u8g2, &user_data);

  u8g2_InitDisplay (&u8g2);
  u8g2_SetPowerSave (&u8g2, 0);
  u8g2_ClearBuffer (&u8g2);
  u8g2_SetFont (&u8g2, u8g2_font_smart_patrol_nbp_tr);
  u8g2_SetFontRefHeightText (&u8g2);
  u8g2_SetFontPosTop (&u8g2);

  while (1)
    {
      u8g2_FirstPage (&u8g2);

      do
        {
          // u8g2_SetDrawColor (&u8g2, 1);
          // u8g2_SetFont (&u8g2, u8g2_font_helvB12_tf);

          switch (screen)
            {
            case 0:
              u8g2_DrawStr (&u8g2, 12, 22, "THIS");
              break;
            case 1:
              u8g2_DrawStr (&u8g2, 24, 22, "IS");
              break;
            case 2:
              u8g2_DrawBitmap (&u8g2, 0, 0, 8, 32, logo);
              break;
            case 4:
              u8g2_DrawStr (&u8g2, 24, 22, "Vova Hi !");
              break;
            case 5:
              u8g2_DrawStr (&u8g2, 4, 42, "Everything !!!!!!!!!!!!!!!! Ok !");
              break;
            case 6:
              u8g2_DrawDisc (&u8g2, 10, 18, 9, U8G2_DRAW_ALL);
              u8g2_DrawCircle (&u8g2, 10, 18 + 30, 9, U8G2_DRAW_ALL);
              u8g2_DrawLine (&u8g2, 7, 10, 40, 55);
              u8g2_DrawBox (&u8g2, 50, 10, 20, 10);
              u8g2_DrawFrame (&u8g2, 50, 10 + 30, 20, 10);
              break;
            }
        }
      while (u8g2_NextPage (&u8g2));

      /* show screen in next iteration */
      // screen = (screen + 1) % 3;
      if (++screen > 6)
        screen = 0;

      /* sleep a little */
      sleep (1);
    }

  u8x8_linux_spi_release (&u8g2);
}
